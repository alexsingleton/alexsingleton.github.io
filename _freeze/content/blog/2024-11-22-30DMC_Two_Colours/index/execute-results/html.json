{
  "hash": "ac2a1600700d3b49f83772e1427920f1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"30 Day Map Challenge: 2 Colours\"\ndate: \"2024-11-22\"\ncategories: [Maps]\nimage: \"D22.png\"\nexecute:\n  echo: true\n  message: false\n  warning: false\n---\n\n\n\n# Day 22: 2 Colours\n\nFor today's challenge, I decided to create a simple plot using some political data from the 2024 UK Election. Labour won overall with a large majority of seats, however, Reform UK, despite not winning many seats also performed far more strongly that many predicted. In this map, we look at second place votes within Labour majority areas.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(janitor)\nlibrary(magrittr)\nlibrary(patchwork)\nlibrary(readxl)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwpc_sf <- st_read(\"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Westminster_Parliamentary_Constituencies_July_2024_Boundaries_UK_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `OGRGeoJSON' from data source \n  `https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Westminster_Parliamentary_Constituencies_July_2024_Boundaries_UK_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 650 features and 11 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -8.649996 ymin: 49.86479 xmax: 1.763706 ymax: 60.86078\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\nThe election data are download from [here](https://commonslibrary.parliament.uk/research-briefings/cbp-10009/) and read into R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read Election Data and fix column names\ned <- read_csv(\"HoC-GE2024-results-by-constituency.csv\") %>% clean_names()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwpc_sf %<>%\n  left_join(ed, by = c(\"PCON24CD\" = \"ons_id\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nUK_SF <- st_read(\"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Authority_Districts_May_2024_Boundaries_UK_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `OGRGeoJSON' from data source \n  `https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Authority_Districts_May_2024_Boundaries_UK_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 361 features and 11 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -8.649996 ymin: 49.86479 xmax: 1.763706 ymax: 60.86077\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nR_SF <- st_read(\"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Regions_December_2023_Boundaries_EN_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `OGRGeoJSON' from data source \n  `https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Regions_December_2023_Boundaries_EN_BGC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson' \n  using driver `GeoJSON'\nSimple feature collection with 9 features and 10 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -6.418667 ymin: 49.86479 xmax: 1.763706 ymax: 55.81112\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nW_SF <- st_read(\"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Countries_December_2023_Boundaries_UK_BGC/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=27700&f=json\") %>%\n  filter(CTRY23NM == \"Wales\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ESRIJSON' from data source \n  `https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Countries_December_2023_Boundaries_UK_BGC/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=27700&f=json' \n  using driver `ESRIJSON'\nSimple feature collection with 4 features and 11 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -116.1928 ymin: 5352.6 xmax: 655653.8 ymax: 1220299\nProjected CRS: OSGB36 / British National Grid\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to point\nwpc_points_sf <- wpc_sf %>%\n  st_drop_geometry() %>% # Drop existing geometry\n  st_as_sf(coords = c(\"BNG_E\", \"BNG_N\"), crs = 27700) %>% # Convert to point SF with British National Grid (EPSG:27700)\n  select(PCON24CD, PCON24NM, first_party, second_party, lab, ruk,majority) # Keep only the desired columns\n```\n:::\n\n\n\nNext we will subset those parliamentary constituencies where Labour won, but Reform took second place.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwpc_points_sf <- wpc_points_sf %>%\n  filter(first_party == \"Lab\")\n\nwpc_points_RUK_sf <- wpc_points_sf %>%\n  filter(first_party == \"Lab\" & second_party == \"RUK\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall <- ggplot() +\n    geom_sf(data = UK_SF,color = NA, fill = \"#1d3557\" ) +\n  geom_sf(data = wpc_points_sf, color = \"#e63946\", aes(size = 1)) +\n  scale_size_continuous(range = c(0, 1))  + \n   coord_sf(crs = st_crs(27700)) +\n  theme_minimal() +\n   theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    axis.title = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.spacing = unit(0, \"mm\"),\n    plot.margin = unit(rep(0, 4), \"mm\"),\n    plot.background = element_rect(fill = 'white', colour = 'white'),\n    legend.position = \"none\"\n  ) +  ggtitle('All Labour Wins')\n\nRUK <- ggplot() +\n    geom_sf(data = UK_SF,color = NA, fill=\"#1d3557\") +\n  geom_sf(data = wpc_points_RUK_sf, color = \"#e63946\", aes(size = 1)) +\n  scale_size_continuous(range = c(0, 1))  + \n   coord_sf(crs = st_crs(27700)) +\n  theme_minimal() +\n   theme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    axis.title = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.spacing = unit(0, \"mm\"),\n    plot.margin = unit(rep(0, 4), \"mm\"),\n    plot.background = element_rect(fill = 'white', colour = 'white'),\n    legend.position = \"none\"\n  ) +  ggtitle('Labour Wins Where Reform UK\\nCame in Second Place')\n\nall + RUK\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\nFor those constituency that are in England, we can also a look at these patterns relative to the [Index of Multiple Deprivation](https://commonslibrary.parliament.uk/research-briefings/cbp-7327/). First we read in these data and append the IMD values to the election outcomes. We then code a new variable that indicates where Labour won, and where Labour won, but Reform UK came second.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read IMD data\n\nIMD <- read_excel(\"Deprivation-in-English-constituencies.xlsx\", skip = 5) %>% \n  as_tibble() %>%\n  clean_names()\n\n# Subset to only England WPC and join IMD\nwpc_points_sf %<>%\n   filter(startsWith(PCON24CD, \"E\")) %>%\n  left_join(IMD, by = c(\"PCON24CD\" = \"constituency_code\")) \n\n# Create map variable\nwpc_points_sf %<>%\n  mutate(LAB_RUK = ifelse(first_party == \"Lab\" & second_party == \"RUK\", TRUE, FALSE))\n```\n:::\n\n\n\nWe can then plot these as a bar chart. The X axis has a bar for each constituency, ordered by their ranked deprived (Y axis). A low score is the most deprived. The dotted line represents the most deprived quintile of the IMD and there is quite an interesting correspondence of where reform have done well in Labour majority areas.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the bar plot with ordering\nggplot(wpc_points_sf, aes(x = fct_reorder(PCON24NM, index_of_multiple_deprivation), \n                          y = index_of_multiple_deprivation, fill = LAB_RUK)) +\n  geom_bar(stat = \"identity\",width = 1) +\n  scale_fill_manual(values = c(\"TRUE\" = \"#e63946\", \"FALSE\" = \"#1d3557\")) +\n    geom_vline(xintercept = 109, color = \"#e63946\", linetype = \"dashed\", size = 0.5) +\n  labs(\n    x = \"Constituency\",\n    y = \"Index of Multiple Deprivation\",\n    title = \"Index of Multiple Deprivation by Constituency\",\n    fill = \"LAB_RUK\"\n  ) +\ntheme_minimal() +\n  theme(\n    axis.text = element_blank(),\n    axis.ticks = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    plot.background = element_rect(fill = 'white', colour = 'white'),\n    legend.position = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}